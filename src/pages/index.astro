---
export const prerender = false;

import { supabase } from "../lib/supabase";

const siteUrl = process.env.SITE_URL ?? "http://localhost:4323";

// Pull latest published articles for the homepage
const { data: latest, error } = await supabase
  .from("public_articles")
  .select("id, title, slug, excerpt, featured_image, published_at")
  .order("published_at", { ascending: false })
  .limit(18);

if (error) console.error("Homepage load error:", error);

const articles = latest ?? [];
const hero = articles[0];
const grid = articles.slice(1, 7);
const more = articles.slice(7, 18);

const canonical = `${siteUrl}/`;
const title = "Lux Exposé | Luxury Lifestyle, Travel, Watches, Cars, Spirits";
const description =
  "Luxury lifestyle editorial covering travel, hotels, watches, cars, fashion, and spirits — curated by Lux Exposé.";
const ogImage =
  hero?.featured_image ??
  "https://luxexpose.com/wp-content/uploads/2023/08/LuxExpose-Logo.png";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonical} />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:url" content={canonical} />
    <meta property="og:type" content="website" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <style>
      :root {
        --bg: #070708;
        --panel: rgba(255,255,255,0.06);
        --panel2: rgba(255,255,255,0.08);
        --text: rgba(255,255,255,0.92);
        --muted: rgba(255,255,255,0.68);
        --muted2: rgba(255,255,255,0.55);
        --border: rgba(255,255,255,0.10);
        --gold: #d6b35e;
        --max: 1160px;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
        color: var(--text);
        background:
          radial-gradient(1200px 600px at 20% 0%, rgba(214,179,94,0.18), transparent 55%),
          radial-gradient(900px 500px at 90% 10%, rgba(255,255,255,0.08), transparent 55%),
          var(--bg);
      }
      a { color: inherit; text-decoration: none; }
      .wrap { max-width: var(--max); margin: 0 auto; padding: 0 18px; }

      /* Top bar */
      .topbar {
        position: sticky; top: 0; z-index: 20;
        backdrop-filter: blur(10px);
        background: rgba(7,7,8,0.72);
        border-bottom: 1px solid var(--border);
      }
      .topbar-inner { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; gap: 16px; }
      .brand { display:flex; align-items:center; gap:12px; }
      .logo {
        width: 34px; height: 34px; border-radius: 10px;
        background: linear-gradient(145deg, rgba(214,179,94,0.38), rgba(255,255,255,0.08));
        border: 1px solid rgba(214,179,94,0.25);
        box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      }
      .brand-title { font-weight: 700; letter-spacing: 0.10em; text-transform: uppercase; font-size: 12px; }
      .brand-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }
      .nav { display:flex; align-items:center; gap: 14px; color: var(--muted); font-size: 13px; }
      .nav a:hover { color: var(--text); }
      .cta {
        border: 1px solid rgba(214,179,94,0.35);
        background: rgba(214,179,94,0.10);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        font-size: 13px;
      }
      .cta:hover { background: rgba(214,179,94,0.16); }

      /* Hero */
      .hero { padding: 34px 0 18px; }
      .hero-grid {
        display: grid;
        grid-template-columns: 1.35fr 0.65fr;
        gap: 18px;
      }
      .card {
        border: 1px solid var(--border);
        background: linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
        border-radius: 18px;
        overflow: hidden;
        box-shadow: 0 18px 40px rgba(0,0,0,0.35);
      }
      .hero-card { position: relative; min-height: 420px; }
      .hero-img {
        position:absolute; inset:0;
        background-size: cover;
        background-position: center;
        filter: saturate(1.05) contrast(1.05);
        transform: scale(1.03);
      }
      .hero-overlay {
        position:absolute; inset:0;
        background: linear-gradient(90deg, rgba(7,7,8,0.88) 0%, rgba(7,7,8,0.55) 45%, rgba(7,7,8,0.25) 100%);
      }
      .hero-content {
        position: relative;
        padding: 26px;
        max-width: 640px;
      }
      .pill {
        display:inline-flex; align-items:center; gap:10px;
        border: 1px solid rgba(214,179,94,0.35);
        background: rgba(7,7,8,0.35);
        padding: 7px 10px;
        border-radius: 999px;
        font-size: 12px;
        color: var(--muted);
      }
      .dot { width:7px; height:7px; border-radius: 99px; background: var(--gold); box-shadow: 0 0 18px rgba(214,179,94,0.6); }
      h1 { margin: 14px 0 10px; font-size: 40px; line-height: 1.06; letter-spacing: -0.02em; }
      .lead { color: var(--muted); font-size: 15px; line-height: 1.6; max-width: 56ch; }
      .hero-actions { margin-top: 16px; display:flex; gap: 10px; flex-wrap: wrap; }
      .btn {
        display:inline-flex; align-items:center; justify-content:center;
        padding: 11px 14px;
        border-radius: 14px;
        font-size: 13px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.06);
        color: var(--text);
      }
      .btn:hover { background: rgba(255,255,255,0.10); }
      .btn-gold { border-color: rgba(214,179,94,0.45); background: rgba(214,179,94,0.12); }
      .btn-gold:hover { background: rgba(214,179,94,0.18); }

      /* Right column - quick picks */
      .side { padding: 18px; display:flex; flex-direction: column; gap: 12px; }
      .side-title { font-size: 12px; letter-spacing: .12em; text-transform: uppercase; color: var(--muted2); }
      .mini {
        display:flex; gap: 12px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.04);
        border-radius: 14px;
        padding: 10px;
        align-items: center;
      }
      .thumb {
        width: 64px; height: 52px;
        border-radius: 12px;
        background-size: cover;
        background-position: center;
        border: 1px solid rgba(255,255,255,0.10);
        flex: 0 0 auto;
      }
      .mini h3 { margin: 0; font-size: 13px; line-height: 1.25; }
      .mini p { margin: 6px 0 0; font-size: 12px; color: var(--muted); }

      /* Grid section */
      .section { padding: 16px 0 40px; }
      .section-head { display:flex; justify-content: space-between; align-items: end; gap: 16px; margin-bottom: 12px; }
      .section-head h2 { margin: 0; font-size: 18px; letter-spacing: .06em; text-transform: uppercase; }
      .section-head span { color: var(--muted); font-size: 13px; }

      .grid {
        display:grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 14px;
      }
      .post {
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.04);
        border-radius: 18px;
        overflow: hidden;
        transition: transform .2s ease, background .2s ease;
      }
      .post:hover { transform: translateY(-2px); background: rgba(255,255,255,0.06); }
      .post-img {
        width: 100%;
        aspect-ratio: 16 / 9;
        background-size: cover;
        background-position: center;
      }
      .post-body { padding: 14px; }
      .post-title { margin: 0 0 8px; font-size: 14px; line-height: 1.25; }
      .post-excerpt { margin: 0; color: var(--muted); font-size: 13px; line-height: 1.5; }

      /* Footer */
      footer { border-top: 1px solid var(--border); padding: 26px 0; color: var(--muted); font-size: 13px; }

      @media (max-width: 980px) {
        .hero-grid { grid-template-columns: 1fr; }
        h1 { font-size: 34px; }
      }
      @media (max-width: 860px) {
        .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      }
      @media (max-width: 560px) {
        .grid { grid-template-columns: 1fr; }
        .nav { display:none; }
      }
    </style>
  </head>

  <body>
    <div class="topbar">
      <div class="wrap">
        <div class="topbar-inner">
          <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div>
              <div class="brand-title">Lux Exposé</div>
              <div class="brand-sub">Luxury editorial + experiences</div>
            </div>
          </div>

          <div class="nav">
            <a href="/">Home</a>
            <a href="/test">Test</a>
          </div>

          <a class="cta" href="/four-seasons-seoul-unveils-hublot-inspired-art-and-cocktails-for-the-holidays">
            View a live article →
          </a>
        </div>
      </div>
    </div>

    <main class="wrap">
      <section class="hero">
        <div class="hero-grid">
          <div class="card hero-card">
            <div
              class="hero-img"
              style={`background-image:url('${ogImage}')`}
              aria-hidden="true"
            ></div>
            <div class="hero-overlay" aria-hidden="true"></div>

            <div class="hero-content">
              <div class="pill"><span class="dot"></span> Featured story</div>

              <h1>{hero?.title ?? "Welcome to Lux Exposé"}</h1>
              <p class="lead">
                {hero?.excerpt ?? description}
              </p>

              <div class="hero-actions">
                {hero?.slug ? (
                  <a class="btn btn-gold" href={`/${hero.slug}`}>Read feature</a>
                ) : (
                  <a class="btn btn-gold" href="/test">View test page</a>
                )}
                <a class="btn" href="/test">Check OG tags</a>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="side">
              <div class="side-title">Latest picks</div>

              {(articles.slice(1, 5)).map((a) => (
                <a class="mini" href={`/${a.slug}`}>
                  <div
                    class="thumb"
                    style={`background-image:url('${a.featured_image ?? ogImage}')`}
                    aria-hidden="true"
                  ></div>
                  <div>
                    <h3>{a.title}</h3>
                    <p>Read now →</p>
                  </div>
                </a>
              ))}

              {!articles.length && (
                <div style="color: var(--muted); font-size: 13px;">
                  No articles found yet. (This means the DB query returned 0.)
                </div>
              )}
            </div>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="section-head">
          <h2>Trending</h2>
          <span>Fresh from Lux Exposé</span>
        </div>

        <div class="grid">
          {grid.map((a) => (
            <a class="post" href={`/${a.slug}`}>
              <div
                class="post-img"
                style={`background-image:url('${a.featured_image ?? ogImage}')`}
                aria-hidden="true"
              ></div>
              <div class="post-body">
                <h3 class="post-title">{a.title}</h3>
                <p class="post-excerpt">{a.excerpt ?? "Read this story on Lux Exposé."}</p>
              </div>
            </a>
          ))}
        </div>
      </section>

      <section class="section">
        <div class="section-head">
          <h2>More stories</h2>
          <span>Daily luxury editorial</span>
        </div>

        <div class="grid">
          {more.map((a) => (
            <a class="post" href={`/${a.slug}`}>
              <div
                class="post-img"
                style={`background-image:url('${a.featured_image ?? ogImage}')`}
                aria-hidden="true"
              ></div>
              <div class="post-body">
                <h3 class="post-title">{a.title}</h3>
                <p class="post-excerpt">{a.excerpt ?? "Read this story on Lux Exposé."}</p>
              </div>
            </a>
          ))}
        </div>
      </section>

      <footer>
        © {new Date().getFullYear()} Lux Exposé. Built with Astro SSR + Supabase.
      </footer>
    </main>
  </body>
</html>