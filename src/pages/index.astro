---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";
import FeaturedHero from "../components/FeaturedHero.astro";
import EditorialGrid from "../components/EditorialGrid.astro";

const FUNCTIONS_BASE = "https://ppmdgygupuzthqxfippv.supabase.co/functions/v1";
const SITE_URL = "https://luxexpose.com";

let featured: any = null;
let rest: any[] = [];

try {
  const res = await fetch(`${FUNCTIONS_BASE}/mobile-api-feed`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ type: "latest", page: 1, limit: 25 }),
  });

  if (res.ok) {
    const data = await res.json();
    const articles = data?.articles ?? [];
    featured = articles[0] ?? null;
    rest = articles.slice(1);
  }
} catch {
  featured = null;
  rest = [];
}

const homeTitle = "Lux Exposé — Luxury Editorial, Travel, Autos, Real Estate";
const homeDesc =
  "Luxury editorial featuring world-class travel, horology, automotive icons, exceptional real estate, and exclusive experiences.";
const canonicalUrl = `${SITE_URL}/`;
---

<Layout>
  <span slot="title">{homeTitle}</span>

  <meta slot="head" name="description" content={homeDesc} />
  <link slot="head" rel="canonical" href={canonicalUrl} />

  <!-- Open Graph -->
  <meta slot="head" property="og:title" content={homeTitle} />
  <meta slot="head" property="og:description" content={homeDesc} />
  <meta slot="head" property="og:url" content={canonicalUrl} />
  <meta slot="head" property="og:type" content="website" />
  <meta slot="head" property="og:site_name" content="Lux Exposé" />

  <!-- Twitter -->
  <meta slot="head" name="twitter:card" content="summary_large_image" />
  <meta slot="head" name="twitter:title" content={homeTitle} />
  <meta slot="head" name="twitter:description" content={homeDesc} />

  <Navbar />

  <div class="relative bg-gradient-subtle overflow-hidden min-h-screen">
    <FeaturedHero article={featured} />
    <EditorialGrid articles={rest} />
  </div>
</Layout>