---
// src/components/city/NeighborhoodExplorer.astro
import { getCityNeighborhoods } from '../../lib/queries/neighborhoods'

interface Props {
  citySlug: string;
  cityDisplayName?: string;
  title?: string;
  subtitle?: string;
}

const { 
  citySlug, 
  cityDisplayName,
  title = "Explore the Neighborhoods",
  subtitle = "Discover the unique character and luxury offerings of each distinctive area"
} = Astro.props;

// Fetch neighborhoods from database
let neighborhoods = [];
try {
  neighborhoods = await getCityNeighborhoods(citySlug);
} catch (error) {
  console.error('Error fetching neighborhoods:', error);
  neighborhoods = [];
}

const reactAppUrl = import.meta.env.PUBLIC_REACT_APP_URL || 'https://luxexpose.com';
---

{neighborhoods && neighborhoods.length > 0 && (
  <section class="neighborhood-explorer py-16">
    <div class="container mx-auto px-4">
      <!-- Header -->
      <div class="text-center mb-12">
        <h2 class="section-title">{title}</h2>
        <p class="section-subtitle">
          {subtitle}
        </p>
      </div>

      <!-- Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {neighborhoods.map((neighborhood, index) => (
          <a 
            href={`${reactAppUrl}/${citySlug}/neighborhoods/${neighborhood.slug}`}
            class="neighborhood-card group"
            style={`animation-delay: ${index * 0.1}s`}
          >
            <!-- Image -->
            <div class="card-image-container">
              <img
                src={neighborhood.image_url || 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800'}
                alt={neighborhood.name}
                class="card-image"
                loading="lazy"
              />
              <div class="card-gradient"></div>
            </div>

            <!-- Content -->
            <div class="card-content">
              <div class="card-header">
                <h3 class="card-title">{neighborhood.name}</h3>
                <!-- MapPin Icon -->
                <svg class="map-pin-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
              </div>
              <p class="card-description">{neighborhood.description}</p>
              <div class="card-cta">
                <span>Explore this area</span>
                <!-- ArrowRight Icon -->
                <svg class="arrow-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="5" y1="12" x2="19" y2="12"/>
                  <polyline points="12 5 19 12 12 19"/>
                </svg>
              </div>
            </div>

            <!-- Hover Border -->
            <div class="hover-border"></div>
          </a>
        ))}
      </div>
    </div>
  </section>
)}

<style>
  .neighborhood-explorer {
    background: hsl(var(--background));
  }

  .section-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2.25rem, 4vw, 3rem); /* 36px â†’ 48px */
    font-weight: 700;
    color: hsl(var(--foreground));
    margin-bottom: 1rem;
  }

  .section-subtitle {
    font-family: 'Inter', sans-serif;
    font-size: 1.125rem; /* 18px */
    font-weight: 400;
    color: hsl(var(--muted-foreground));
    max-width: 42rem; /* max-w-2xl */
    margin: 0 auto;
  }

  .neighborhood-card {
    position: relative;
    overflow: hidden;
    border-radius: 1rem; /* rounded-2xl = 16px */
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    transition: all 500ms ease;
    cursor: pointer;
    display: block;
    text-decoration: none;
    animation: fadeIn 0.6s ease forwards;
    opacity: 0;
  }

  @keyframes fadeIn {
    to { 
      opacity: 1; 
    }
  }

  .neighborhood-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  }

  .card-image-container {
    aspect-ratio: 4 / 3;
    overflow: hidden;
    position: relative;
  }

  .card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 700ms ease;
  }

  .neighborhood-card:hover .card-image {
    transform: scale(1.1);
  }

  .card-gradient {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to top,
      hsl(var(--background)) 0%,
      hsl(var(--background) / 0.6) 50%,
      transparent 100%
    );
    opacity: 0.9;
  }

  .card-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 1.5rem; /* p-6 = 24px */
  }

  .card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 0.5rem;
  }

  .card-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem; /* 24px */
    font-weight: 700;
    color: hsl(var(--foreground));
    transition: color 300ms ease;
    margin: 0;
  }

  .neighborhood-card:hover .card-title {
    color: hsl(43 35% 48%); /* --luxury-gold */
  }

  .map-pin-icon {
    width: 20px;
    height: 20px;
    color: hsl(43 35% 48%); /* --luxury-gold */
    flex-shrink: 0;
    margin-top: 0.25rem;
  }

  .card-description {
    font-family: 'Inter', sans-serif;
    font-size: 0.875rem; /* 14px */
    font-weight: 400;
    color: hsl(var(--muted-foreground));
    margin-bottom: 1rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.5;
  }

  .card-cta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'Inter', sans-serif;
    font-size: 0.875rem; /* 14px */
    font-weight: 500;
    color: hsl(43 35% 48%); /* --luxury-gold */
  }

  .arrow-icon {
    width: 16px;
    height: 16px;
    transition: transform 300ms ease;
  }

  .neighborhood-card:hover .arrow-icon {
    transform: translateX(4px);
  }

  .hover-border {
    position: absolute;
    inset: 0;
    border: 2px solid transparent;
    border-radius: 1rem;
    transition: border-color 300ms ease;
    pointer-events: none;
  }

  .neighborhood-card:hover .hover-border {
    border-color: hsl(43 35% 48% / 0.2); /* --luxury-gold at 20% opacity */
  }
</style>

<script>
  // Handle image loading errors with fallback
  document.addEventListener('DOMContentLoaded', () => {
    const images = document.querySelectorAll('.card-image');
    const fallbackImage = 'https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800';
    
    images.forEach((img) => {
      img.addEventListener('error', function() {
        if (this.src !== fallbackImage) {
          this.src = fallbackImage;
        }
      });
    });
  });
</script>

