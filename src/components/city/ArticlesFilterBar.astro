---
// src/components/city/ArticlesFilterBar.astro

interface Props {
  citySlug: string;
  cityName: string;
  totalArticles: number;
  currentCount: number;
  categories: Array<{ slug: string; name: string }>;
  cities: Array<{ slug: string; name: string; path: string; available: boolean }>;
  currentCategory?: string;
  searchQuery?: string;
}

const { 
  citySlug, 
  cityName, 
  totalArticles, 
  currentCount,
  categories,
  cities,
  currentCategory = 'all',
  searchQuery = ''
} = Astro.props;
---

<section class="container mx-auto px-4 pb-8">
  <div class="max-w-4xl mx-auto">
    
    <!-- City Selector Row -->
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-2">
        <!-- MapPin Icon (Lucide) -->
        <svg 
          class="h-4 w-4 text-muted-foreground" 
          xmlns="http://www.w3.org/2000/svg" 
          width="16" 
          height="16" 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          stroke-width="2" 
          stroke-linecap="round" 
          stroke-linejoin="round"
        >
          <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/>
          <circle cx="12" cy="10" r="3"/>
        </svg>
        
        <!-- City Selector Dropdown -->
        <div class="relative">
          <select 
            id="city-selector"
            class="city-select w-[200px] h-10 rounded-md border border-input bg-background/50 backdrop-blur px-3 py-2 text-sm text-foreground appearance-none cursor-pointer pr-8 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
            data-current={citySlug}
          >
            <option value="all">All Cities</option>
            {cities.map(city => (
              <option 
                value={city.slug} 
                selected={city.slug === citySlug}
                disabled={!city.available}
              >
                {city.name}{!city.available ? ' (Coming Soon)' : ''}
              </option>
            ))}
          </select>
          
          <!-- Chevron Icon -->
          <svg 
            class="absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 opacity-50 pointer-events-none" 
            xmlns="http://www.w3.org/2000/svg" 
            width="16" 
            height="16" 
            viewBox="0 0 24 24" 
            fill="none" 
            stroke="currentColor" 
            stroke-width="2" 
            stroke-linecap="round" 
            stroke-linejoin="round"
          >
            <path d="m6 9 6 6 6-6"/>
          </svg>
        </div>
      </div>
    </div>
    
    <!-- Search & Category Filters Grid -->
    <div class={`grid gap-4 ${categories.length > 0 ? 'md:grid-cols-2' : 'md:grid-cols-1'}`}>
      
      <!-- Search Input -->
      <div class="relative">
        <!-- Search Icon -->
        <svg 
          class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" 
          xmlns="http://www.w3.org/2000/svg" 
          width="16" 
          height="16" 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          stroke-width="2" 
          stroke-linecap="round" 
          stroke-linejoin="round"
        >
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.3-4.3"/>
        </svg>
        
        <input
          type="text"
          id="article-search"
          placeholder="Search articles..."
          value={searchQuery}
          class="flex h-10 w-full rounded-md border border-input bg-background pl-10 pr-3 py-2 text-base md:text-sm text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
        />
      </div>
      
      <!-- Category Filter Dropdown -->
      {categories.length > 0 && (
        <div class="relative">
          <select 
            id="category-filter"
            class="category-select flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm text-foreground appearance-none cursor-pointer pr-8 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
            data-current={currentCategory}
          >
            <option value="all">All Categories</option>
            {categories.map(cat => (
              <option value={cat.slug} selected={cat.slug === currentCategory}>
                {cat.name}
              </option>
            ))}
          </select>
          
          <!-- Chevron Icon -->
          <svg 
            class="absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 opacity-50 pointer-events-none" 
            xmlns="http://www.w3.org/2000/svg" 
            width="16" 
            height="16" 
            viewBox="0 0 24 24" 
            fill="none" 
            stroke="currentColor" 
            stroke-width="2" 
            stroke-linecap="round" 
            stroke-linejoin="round"
          >
            <path d="m6 9 6 6 6-6"/>
          </svg>
        </div>
      )}
    </div>
    
    <!-- Results Count -->
    <div class="mt-4 text-sm text-muted-foreground text-center">
      Showing {currentCount} of {totalArticles} articles
    </div>
    
  </div>
</section>

<style>
  /* Custom select styling */
  .city-select,
  .category-select {
    font-family: 'Inter', sans-serif;
  }
  
  .city-select option,
  .category-select option {
    background: hsl(30, 5%, 12%);
    color: hsl(0, 0%, 98%);
    padding: 8px 12px;
  }
  
  .city-select option:disabled,
  .category-select option:disabled {
    opacity: 0.5;
  }
  
  /* Focus ring colors */
  .city-select:focus,
  .category-select:focus,
  #article-search:focus {
    --tw-ring-color: hsl(43, 35%, 48%);
  }
  
  /* Placeholder color */
  #article-search::placeholder {
    color: hsl(0, 0%, 60%);
  }
  
  /* Container max width */
  .max-w-4xl {
    max-width: 896px;
  }
  
  /* Gap utilities */
  .gap-4 {
    gap: 1rem; /* 16px */
  }
  
  .gap-2 {
    gap: 0.5rem; /* 8px */
  }
  
  /* Text colors */
  .text-muted-foreground {
    color: hsl(0, 0%, 60%);
  }
  
  .text-foreground {
    color: hsl(0, 0%, 98%);
  }
  
  /* Border color */
  .border-input {
    border-color: hsl(0, 0%, 15%);
  }
  
  /* Background */
  .bg-background {
    background-color: hsl(30, 5%, 10%);
  }
  
  .bg-background\/50 {
    background-color: hsl(30, 5%, 10% / 0.5);
  }
  
  /* Backdrop blur */
  .backdrop-blur {
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
  }
</style>

<script is:inline>
  // City selector navigation
  (function() {
    const citySelector = document.getElementById('city-selector');
    if (citySelector) {
      citySelector.addEventListener('change', function(e) {
        const value = e.target.value;
        if (value === 'all') {
          window.location.href = '/';
        } else {
          window.location.href = '/' + value;
        }
      });
    }
  })();
  
  // Search input with debounce
  (function() {
    let searchTimeout;
    const searchInput = document.getElementById('article-search');
    
    if (searchInput) {
      searchInput.addEventListener('input', function(e) {
        clearTimeout(searchTimeout);
        const value = e.target.value;
        
        searchTimeout = setTimeout(function() {
          const url = new URL(window.location.href);
          if (value) {
            url.searchParams.set('q', value);
          } else {
            url.searchParams.delete('q');
          }
          url.searchParams.delete('page'); // Reset pagination
          window.location.href = url.toString();
        }, 500); // 500ms debounce
      });
    }
  })();
  
  // Category filter navigation
  (function() {
    const categoryFilter = document.getElementById('category-filter');
    if (categoryFilter) {
      categoryFilter.addEventListener('change', function(e) {
        const value = e.target.value;
        const url = new URL(window.location.href);
        
        if (value === 'all') {
          url.searchParams.delete('category');
        } else {
          url.searchParams.set('category', value);
        }
        url.searchParams.delete('page'); // Reset pagination
        window.location.href = url.toString();
      });
    }
  })();
</script>

