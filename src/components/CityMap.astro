---
interface Location {
  name: string;
  lat: number;
  lng: number;
  type?: string;
}

interface Props {
  cityName: string;
  centerLat: number;
  centerLng: number;
  zoom?: number;
  locations?: Location[];
}

const { cityName, centerLat, centerLng, zoom = 12, locations = [] } = Astro.props;
---

<section class="w-full">
  <div class="mb-6">
    <h2 class="font-serif text-3xl md:text-4xl text-white mb-2">
      Explore {cityName}
    </h2>
    <p class="text-white/70">
      Discover luxury experiences and destinations
    </p>
  </div>

  <div class="w-full h-[400px] md:h-[500px] rounded-xl overflow-hidden border border-white/10 bg-black/40">
    <div id={`map-${cityName.toLowerCase().replace(/\s+/g, "-")}`} class="w-full h-full">
      <!-- Map will be initialized client-side -->
      <div class="w-full h-full flex items-center justify-center text-white/50">
        <p>Map loading...</p>
      </div>
    </div>
  </div>

  <!-- Load Leaflet from CDN -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <script define:vars={{ cityName, centerLat, centerLng, zoom, locations }} is:inline>
    // Initialize Leaflet map (L is loaded from CDN)
    (function() {
      const mapId = `map-${cityName.toLowerCase().replace(/\s+/g, "-")}`;
      const mapElement = document.getElementById(mapId);
      
      // Wait for Leaflet to load
      function initMap() {
        if (typeof L === 'undefined') {
          setTimeout(initMap, 100);
          return;
        }
        
        if (mapElement) {
          const map = L.map(mapId).setView([centerLat, centerLng], zoom);
          
          L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
          }).addTo(map);

          // Add markers for locations
          if (locations && Array.isArray(locations)) {
            locations.forEach((location) => {
              L.marker([location.lat, location.lng])
                .addTo(map)
                .bindPopup(location.name);
            });
          }
        }
      }
      
      // Start initialization
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initMap);
      } else {
        initMap();
      }
    })();
  </script>
</section>

